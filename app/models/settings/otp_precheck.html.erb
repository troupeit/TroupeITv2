<style>
.table tr td {
  padding: 30px !important;
}

.centered {
  text-align: center;
  margin: 0 auto;
}

</style>

<div class="col-md-12">
<div class="col-md-offset-2 col-md-8 col-md-offset-2">
<h2>Configure Two Factor Authentication</h2>

<div class="panel panel-default">
  <div class="panel-body">
<P>
  Once configured, you'll be required to enter a code created by one
  of the Google Authenticator
  (<a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" target="_2fa">Android</a>,
  <a href="https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8" target="_2fa">Apple Devices</A>),
  
  <a href="https://www.duosecurity.com/product/methods/duo-mobile" target="_2fa">Duo Mobile</a>,
  or <a href="http://www.windowsphone.com/en-us/store/app/authenticator/021dd79f-0598-e011-986b-78e7d1fa76f8" target="_2fa">Windows Phone Authenticator</a> apps in order to sign into your account.
</P>
<div class="row"><div class="col-md-12"><hr></div></div>
  <div class="row">
     <div class="col-md-4 centered">
     <%= image_tag "2FA/authenticators.jpg" %>
     </div>
     <div class="col-md-8">
     <h5>Step 1</h5>
     <h4>Get the App</h4>
      Download and install
 Google Authenticator
  (<a href="https://play.google.com/store/apps/details?id=com.google.android.apps.authenticator2" target="_2fa">Android</a>,
  <a href="https://itunes.apple.com/us/app/google-authenticator/id388497605?mt=8" target="_2fa">Apple Devices</A>),
  
  <a href="https://www.duosecurity.com/product/methods/duo-mobile" target="_2fa">Duo Mobile</a>,
  or <a href="http://www.windowsphone.com/en-us/store/app/authenticator/021dd79f-0598-e011-986b-78e7d1fa76f8" target="_2fa">Windows Phone Authenticator</a> 
    for your phone or tablet.
     </div>
  </div>
  <div class="row"><div class="col-md-12"><hr></div></div>
  <div class="row">
    <div class="col-md-4 centered">  
      <% provuri = current_user.provisioning_uri + "&issuer=TroupeIT" %>
      <%=raw RQRCode::render_qrcode(provuri, 
          :svg,
          :level => :l,
      :unit => 4) %>
    </div>

  <div class="col-md-8">
  <h5>Step 2</h5>
  <h4>Scan this QR code</h4>
  Open the authentication app and:
  <ul>
    <li>Tap the "+" icon in the top right of the app.</li>
    <li>Scan the image to the left, using your phone's camera.</li>
  </ul>
  <P><font size="-1">( <a href="#" onclick="toggle_otp_detail()">Can't scan this QR Code?</a> )</font></P>
  <div id="otp_detail" style="display: none;">
  <UL>
    <LI> Go to this URL in your authenticator application:<BR><strong><%=provuri %></strong></LI>
    <LI> Or, Manually enter the secret:<BR> <strong><%=current_user.otp_secret_key %></strong></LI>
  </UL>
  </div>
  
  </div>
  </div>
<div class="row"><div class="col-md-12"><hr></div></div>
  <div class="row">
  <div class="col-md-4 centered">
  <%= image_tag "2FA/phonecodes.jpg" %>
  </div>
  <div class="col-md-8">
  <h5>Step 3</h5>
  <h4>Enter Verification Code</h4>
  Once the barcode is scanned, enter the <strong>six-digit verification code</strong> generated by the app and your <strong>current
  password</strong> to enable two-factor authentication.

  <%= form_tag "/settings/otp_activate" do %>

  <div class="row">
    <div class="col-md-4">
      <input type="text" class="form-control" maxlength="6" autocomplete="off" name="otpcode" placeholder="Code">
    </div>
  </div>

  <div class="row">
    <div class="col-md-8">
      <input type="password" class="form-control" autocomplete="off" name="password" placeholder="Current Password"> 
    </div>
    <div class="col-md-4">
      <input type="submit" class="btn btn-warning" value="Enable 2FA">
    </div>
  </div>

  <% end -%>
  </div>
  </div>
  </div>
</div>
<%= link_to "I don't want to do this right now.", "/settings/edit", :class =>"btn btn-danger", :method => :get %>

</div>


</div>

<script>
    function toggle_otp_detail() {
      $( "#otp_detail" ).slideToggle( "slow", function() {
        // Animation complete.
    });
    };

</script>

